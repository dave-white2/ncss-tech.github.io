---
title: "OSD Dendrogram via Soil Taxonomy"
author: "D.E. Beaudette"
date: "`r Sys.Date()`"
output:
  html_document:
  mathjax: null
jquery: null
smart: no
keep_md: no
---
  
```{r setup, echo=FALSE, results='hide', warning=FALSE}
# setup
library(knitr, quietly=TRUE)
opts_chunk$set(message=FALSE, warning=FALSE, background='#F7F7F7', fig.align='center', fig.retina=2, dev='png', tidy=FALSE, verbose=FALSE)
options(width=100, stringsAsFactors=FALSE, cache=TRUE)
```


```{r get-data}
library(aqp)
library(soilDB)
library(sharpshootR)

# soils of interest
s.list <- c('hornitos', 'perkins', 'argonaut', 'inks', 'mokelumne', 'dunstone', 'auburn', 'pentz', 'pardee', 'peters', 'amador', 'laniger')

# fetch and convert data into an SPC
s <- fetchOSD(s.list)
```


```{r check-via-plotting, fig.width=16, fig.height=6}
# estimate soil depth based on horizon designation
s$soil.depth <- profileApply(s, estimateSoilDepth, name='hzname')

# plot profiles, order by soil depth
par(mar=c(0, 0, 0, 0))
plot(s, name='hzname', plot.order=order(s$soil.depth), cex.names=0.85, axis.line.offset=-5, width=0.25, id.style='top')
```

```{r plot-dendrogram, fig.width=14, fig.height=6}
# plot dendrogram + profiles
# result is the distance matrix used to generate dendrogram
d <- SoilTaxonomyDendrogram(s, cex.taxon.labels=0.8, width=0.25, y.offset = 0.4)
```


Approximate sorting of dendrogram according to catenary position ([hillslope position proportions](https://www.nrcs.usda.gov/wps/portal/nrcs/detail/?cid=nrcs142p2_054252#describe)).
```{r fig.width=8, fig.height=4}
# TODO: try norforlk and siblings
# http://soilmap2-1.lawr.ucdavis.edu/dylan/soilweb/sde/?series=norfolk

# set of soil series to query
soils <- c('cecil', 'altavista', 'lloyd', 'wickham', 'wilkes',  'chewacla', 'congaree')

# get morphology + extended summaries
s <- fetchOSD(soils, extended = TRUE)

# extract catenary relationships from hillslope proportion summary
# and display
res <- vizHillslopePosition(s$hillpos)
print(res$fig)
```

Organize ST dendrogram according to catenary position.
```{r fig.width=12, fig.height=12}
par(mar=c(0,0,1,1), mfrow=c(2,1))
SoilTaxonomyDendrogram(s$SPC, width=0.25)
mtext('default sorting', side = 2, line=-1, font=3, cex=1.25)
SoilTaxonomyDendrogram(s$SPC, rotationOrder = res$order, width=0.25)
mtext('approx. catenary sorting', side = 2, line=-1, font=3, cex=1.25)
```

----------------------------
This document is based on `aqp` version `r utils::packageDescription("aqp", field="Version")`, `soilDB` version `r utils::packageDescription("soilDB", field="Version")`, and `sharpshootR` version `r utils::packageDescription("sharpshootR", field="Version")`.
