```{r setup, echo=FALSE, results='hide', warning=FALSE}
# setup
library(knitr)
opts_chunk$set(message=FALSE, warning=FALSE, background='#F7F7F7', fig.retina=2, dev='png', tidy=FALSE, verbose=FALSE, cache = FALSE)
options(width=100, stringsAsFactors=FALSE, cache=FALSE)
```

# Linework Evaluation

```{r get-data}
library(spdep)
library(rgdal)
library(igraph)
library(sharpshootR)
library(lattice)

# load active survey
x <- readOGR(dsn='L:/NRCS/MLRAShared/CA630/Archived_OFFICIAL_DB/final/FG_CA630_GIS_2018.gdb', layer='ca630_a', stringsAsFactors=FALSE)
# x <- readOGR(dsn='L:/NRCS/MLRAShared/CA792/ca792_spatial/FG_CA792_OFFICIAL.gdb', layer='ca792_a', stringsAsFactors=FALSE)

# remove NOTCOM, DA, and empty (non-NA) symbols
x <- x[which(! x$MUSYM %in% c('NOTCOM', 'DAM', 'DA', ' ', '', 'WATER', 'W')), ]

# create polygon adjacency matrix
res <- polygonAdjacency(x, v='MUSYM')

# # graphical check: slow for large number of features
# plot(x)
# plot(x[res$commonLines, ], col='red', add=TRUE)

# save to SHP
# writeOGR(x[res$commonLines, ], dsn='l:/CA630/MapUnits', layer='common-soil-lines', driver='ESRI Shapefile', overwrite_layer=TRUE)
```



```{r ex-1, fig.width=20, fig.height=20}
# plot spatial adjacency information
par(mar=c(0,0,0,0))
plotSoilRelationGraph(res$adjMat, vertex.scaling.factor = 1)
plotSoilRelationGraph(res$adjMat, spanning.tree=0.9, edge.scaling.factor=0.1)
plotSoilRelationGraph(res$adjMat, spanning.tree='max', edge.scaling.factor=0.1, vertex.scaling.factor=1.5)
```


```{r node-diversity, fig.width=8, fig.height=14}
# compute diversity by map unit symbol
g <- plotSoilRelationGraph(res$adjMat, vertex.scaling.factor = 1, plot.style = 'none')
dotplot(sort(graph.diversity(g)))
```

